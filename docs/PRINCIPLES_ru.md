# Принципы архитектуры проекта

## Общие положения

Проект разделён на две основные части: 

#### **Библиотеки**  
Это "кирпичи" программ.  
Они содержат функционал для работы с WAV-файлами:  
* Начальный уровень: чтение заголовков и содержимого;  
* Основной уровень: базовая обработка заголовков и содержимого.  
~~Например, генерация пустого WAV-файлов~~;  
Библиотеки выступают как независимые модули, которые можно переиспользовать в различных программах.

#### **Программы**  
Это "цемент" и "логика здания".  
Программы связывают различные библиотеки и реализуют прикладной функционал.  
Например, склеивание файлов, добавление каналов, преобразование форматов.  
Они определяют, как пользователи взаимодействуют с инструментами.

---

## Принципы проектирования

### Для программ
1. **Чистая архитектура (Clean Architecture)**  
   Все программы организованы так, чтобы главная логика (например, `main`) управляла потоками данных, ресурсами и координацией компонентов, но не содержала деталей реализации.
   Это достигается разбиением задач на функции с чётким распределением ответственности.

2. **Unix-философия**  
   Программы выполняют одну задачу ~~и делают это хорошо~~.  
   Они следуют принципу: "Собирай сложные задачи из простых инструментов".
   Например, программа может быть отдельным инструментом для чтения заголовка WAV или конвертации файла.

3. **Dependency Injection (DI)**  
   Вместо того, чтобы напрямую создавать ресурсы внутри программ,
   они принимают на вход готовые объекты (например, файлы или структуры).
   Это упрощает тестирование и повторное использование кода.

4. **Логика освобождения ресурсов в `main`**  
   Программа чётко следит за управлением ресурсами.  
   Все файлы и другие ресурсы закрываются централизованно в одной точке, что делает код более устойчивым.

### Для библиотек
1. **Минимализм и модульность**  
   Каждая библиотека фокусируется на чётко определённом функционале.  
   Например, библиотека `read_wav` отвечает только за работу с WAV-заголовками, ~~не затрагивая обработку данных~~.

2. **Стабильность интерфейсов**  
   Интерфейс библиотек проектируется так, чтобы минимальные изменения в реализации не приводили к проблемам в зависимости (Backward Compatibility).

3. **Монолитность структур**  
   Код организован в функциональные модули.
   Например, функции для чтения заголовка, расчёта размера данных и их проверки сгруппированы в одном месте.

4. **Частая проверка данных**  
   Код включает обилие проверок, чтобы предотвращать ошибки при работе с WAV-файлами. Например, каждая строка идентификатора в заголовке проверяется на соответствие ожидаемому значению.

5. **Минимальная зависимость от внешних библиотек**  
   Библиотеки опираются только на стандартную библиотеку языка Си.  
   И *GNU Compiler Collection*.

---

## Ключевые идеи реализации

### Чистота `main`
В главной функции (`main`) минимизируются:
- Логирование.
- Вывод сообщений об ошибках.  
Каждая программа концентрируется на управлении ресурсами: открытие и закрытие файлов, передача данных в функции. Подробное логирование выполняется непосредственно в вызываемых функциях.

### Работа с WAV-заголовками
- Поддерживаются все основные проверки формата WAV.
- ~~Обработаны случаи сложных данных (например, наличие "не-аудио" блоков).~~

### Гибкость и расширяемость
Функции из библиотек предоставляют минимально необходимые инструменты для работы с WAV-файлами, оставляя разработчику свободу по их комбинированию.

---
<!---
## Пример главной библиотеки `read_wav`

### Основной функционал библиотеки:
1. **Чтение заголовка WAV**  
   Проверяются все ключевые параметры формата: идентификаторы, размеры блоков, аудиоформат.

2. **Расчёты размеров данных**  
   Функции, такие как `calc_main_data_size`, позволяют разработчику точно вычислять размер полезной нагрузки и служебных данных WAV.

3. **Генерация заголовков**  
   Функция `create_WavHeader_base` предоставляет базовые настройки для нового WAV-файла.

4. **Логирование**  
   Функция `printWavHeader` выводит содержимое заголовка в человекочитаемом формате.

### Код библиотеки: 
Пример полного кода предоставлен ниже в качестве демонстрации используемых подходов и стиля написания:
```c
#ifndef READ_WAV_H
#define READ_WAV_H
/* Описание ключевых функций. */
#include <stdio.h>
#include <stdlib.h>
#include <stdint.h>
#include <string.h>
#include "wav_header_struct.h"

/* Расчёты размера не-аудиоданных. */
uint32_t calc_notData_size(WavHeader *header);
/* Расчёты общего размера заголовка. */
uint32_t calc_header_size(WavHeader *header);
/* Расчёты основного размера данных. */
uint32_t calc_main_data_size(WavHeader *header);
/* Чтение заголовка из файла. */
int readWavHeader(FILE *file, WavHeader *header);
/* Создание базового заголовка. */
void create_WavHeader_base(WavHeader *header, uint16_t numChannels);
/* Вывод заголовка. */
void printWavHeader(WavHeader *header);
/* Копирование заголовка с обновлением данных. */
void copy_WavHeader(WavHeader *in_header, WavHeader *out_header);
#endif /* READ_WAV_H */
```
-->
## Связь с README_ru.md

Этот файл дополняет описание проекта в `README_ru.md`, предоставляя разработчикам полное понимание используемых подходов. Вместе они служат ключевыми документами для сопровождения проекта.
